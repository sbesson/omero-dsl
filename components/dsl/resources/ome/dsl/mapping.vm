<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >
    
<hibernate-mapping>
#set($table = ${type.typeToColumn($type.id)} )
<class 
    name="${type.id}" 
    table="${table}">
	
#if($type.abstract)
	<meta attribute="scope-class" inherit="false">public abstract</meta>
#end
    <meta attribute="implement-equals" inherit="false">true</meta>

	
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	 COMMON
     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
	
	 <id name="id" type="java.lang.Long" column="id">
		<generator class="sequence">
			<param name="sequence">seq_$table</param>
		</generator>
	</id>

#if(!$type.immutable)
	<version name="version" type="java.lang.Integer" column="version" unsaved-value="negative"/>
	<many-to-one name="updateEvent" class="ome.model.meta.Event" not-null="false"/>	
#end
#if(! ${type.id.startsWith("ome.model.meta")})
	<many-to-one name="creationEvent" class="ome.model.meta.Event" not-null="true" cascade="save-update"/>		
#end
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	 INTERFACE-BASED
     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

#if($type.named)
	<property name="name" type="java.lang.String" column="name" not-null="true" length="256"/>
#end
#if($type.described)
   <property name="description" type="java.lang.String" column="description" length="256"/>
#end

#if(!$type.global)	
#if(! ${type.id.startsWith("ome.model.meta")} )
	<many-to-one name="owner" class="ome.model.meta.Experimenter" not-null="true" cascade="save-update"/>
#end
	<component name="permissions" class="ome.model.internal.Permissions">
		<property name="bytes" type="binary" column="permissions"/> 
		<!-- TODO possibly just default CHMOD here -->
	</component>
#end
	
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
	 SPECIFIC
     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
	 
    <!-- Associations -->
	 
#foreach($prop in $type.properties)
#if($prop.class.name == "ome.dsl.EntryField")
<!-- TODO: need EnmerationInitialTask -->
#elseif($prop.one2Many)

	<!-- bi-directional one-to-many association to $prop.name -->
#if($prop.ordered)
    <list
#else
    <set
#end
		name="${prop.name}"
		lazy="true"
		inverse="true"
##TODO		mutable="${prop.mutable}"
		cascade="save-update">
		<key>
			<column name="${table}" />
		</key>
#if($prop.ordered)
       <list-index column="order"/>
#end
		<one-to-many class="${prop.type}"/>
#if($prop.ordered)
    </list>
#else
    </set>
#end
#elseif($prop.foreignKey)

    <!-- bi-directional many-to-one association to $prop.name -->
    <many-to-one
        name="${prop.name}"
        class="${prop.type}"
        not-null="${prop.required}"
		unique="${prop.unique}"
		update="${prop.mutable}">
        <column name="${prop.name}" />
    </many-to-one>

#else

	<property name="${prop.name}" type="${prop.type}" not-null="${prop.required}" unique="${prop.unique}" update="${prop.mutable}"/>

#end
#end
 </class>
</hibernate-mapping>
